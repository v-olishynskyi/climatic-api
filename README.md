# üå¶Ô∏è Climatic API

**Climatic** ‚Äî REST API —Å–µ—Ä–≤—ñ—Å –¥–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–æ–≥–æ–¥–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ email. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –º—ñ—Å—Ç–æ —Ç–∞ —á–∞—Å—Ç–æ—Ç—É (—â–æ–≥–æ–¥–∏–Ω–Ω–æ/—â–æ–¥–µ–Ω–Ω–æ) –æ–Ω–æ–≤–ª–µ–Ω—å.

---

## üìå –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏ –∑ —á–∞—Å—Ç–æ—Ç–æ—é (—â–æ–¥–µ–Ω–Ω–æ/—â–æ–≥–æ–¥–∏–Ω–Ω–æ)
- –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ email
- –†–æ–∑—Å–∏–ª–∫–∞ –ª–∏—Å—Ç—ñ–≤ —á–µ—Ä–µ–∑ BullMQ + Redis
- –ö–µ—à—É–≤–∞–Ω–Ω—è –ø–æ–≥–æ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö (WeatherAPI)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Swagger
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –º—ñ–≥—Ä–∞—Ü—ñ–π (TypeORM)
- Docker

---

API URL: https://climatic-api.onrender.com

---

–õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏ –∞–ø—ñ

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –Ω–∞ –µ–Ω–¥–ø–æ–π–Ω—Ç /subscribe –ø–µ—Ä–µ–¥–∞—é—á–∏ —Ç—É–¥–∏ email (–Ω–∞ —è–∫–∏–π –±—É–¥—É—Ç—å –Ω–∞–¥—Ö–æ–¥–∏—Ç–∏ –ª–∏—Å—Ç–∏), city (–º—ñ—Å—Ç–æ –¥–ª—è –ø–æ–≥–æ–¥–∏) —Ç–∞ frequency (—á–∞—Å—Ç–æ—Ç–∞ —Å–ø–æ–≤—ñ—â–µ–Ω—å –∑ –ø–æ–≥–æ–¥–æ—é)
2. subscription.controller.ts –æ–±—Ä–æ–±–ª—è—î —Ü–µ–π –∑–∞–ø–∏—Ç —Ç–∞ —É subscription.service.ts –≤–∏–∫–æ–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω—É –ª–æ–≥—ñ–∫—É

- –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –º—ñ—Å—Ç–æ –≤–≤–µ–¥–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–∑—Ä–æ–±–∏–≤—à–∏ –∑–∞–ø–∏—Ç –Ω–∞ Weather API)
- —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å–∞—Ç–∏ –≤ –±–∞–∑—É –¥–∞–Ω—ñ —Ü—ñ—î—ó –ø—ñ–¥–ø–∏—Å–∫–∏ (email, city, frequency —Ç–∞ subscription_token —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—å –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏ –∞–±–æ –≤—ñ–¥–ø–∏—Å–∫–∏)
- –¥–æ–¥–∞—Ç–∏ –≤ —á–µ—Ä–≥—É bullMQ job —è–∫–∏–π –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å –ª–∏—Å—Ç –Ω–∞ –ø–æ—à—Ç—É

3. –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ –ª–∏—Å—Ç —Ç–∞ –Ω–∞—Ç–∏—Å–∫–∞—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏
4. subscription.controller.ts –æ–±—Ä–æ–±–ª—è—î —Ü–µ–π –∑–∞–ø–∏—Ç —Ç–∞ —É subscription.service.ts –≤–∏–∫–æ–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω—É –ª–æ–≥—ñ–∫—É

- –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—î –≤ –±–∞–∑—ñ —Ç–∞–∫–∞ –ø—ñ–¥–ø–∏—Å–∫–∞
- —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î - –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ 404
- —è–∫—â–æ —ñ—Å–Ω—É—î - –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ–ª–µ `subscribed: true`

5. —â–æ–≥–æ–¥–∏–Ω–∏ —Ç–∞ —â–æ–¥–Ω—è –æ 07:00 –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è cron job —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω—É –ª–æ–≥—ñ–∫—É (weather-scheduler.service.ts)

- –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –∑ –±–∞–∑–∏ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ `subscribed: true` —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º (—â–æ–≥–æ–¥–∏–Ω–∏/—â–æ–¥–Ω—è) frequency
- —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –º—ñ—Å—Ç –¥–ª—è —è–∫–∏—Ö –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–≥–æ–¥–∞
- –ø–æ —Å–ø–∏—Å–∫—É –º—ñ—Å—Ç –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ Weather API –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≥–æ–¥–∏ (–≤—Å—ñ –∑–∞–ø–∏—Ç–∏ –∫–µ—à—É—é—Ç—å—Å—è —É Redis –∑ TTL=60 \* 60; // 1 hour)
- –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ –≤—Å—å–æ–º—É —Å–ø–∏—Å–∫—É –ø—ñ–¥–ø–∏—Å–æ–∫ —Ç–∞ –Ω–∞ –¥–æ–¥–∞—Ç–∏ –≤—Å—ñ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ª—ñ—Å—Ç—ñ–≤ —É —á–µ—Ä–≥—É (–æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è hourly —Ç–∞ dayli)

6. –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ –ª–∏—Å—Ç –∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –ø–æ–≥–æ–¥–∏ —Ç–∞ –Ω–∞—Ç–∏—Å–∫–∞—î –í—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å
7. subscription.controller.ts –æ–±—Ä–æ–±–ª—è—î —Ü–µ–π –∑–∞–ø–∏—Ç —Ç–∞ —É subscription.service.ts –≤–∏–∫–æ–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω—É –ª–æ–≥—ñ–∫—É

- –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—î –≤ –±–∞–∑—ñ —Ç–∞–∫–∞ –ø—ñ–¥–ø–∏—Å–∫–∞
- —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î - –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ 404
- —è–∫—â–æ —ñ—Å–Ω—É—î - –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ–ª–µ `subscribed: false` —Ç–∞ `unsubscribed_at: new Date()`

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **NestJS** ‚Äî Node.js framework
- **PostgreSQL** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
- **TypeORM** ‚Äî ORM + –º—ñ–≥—Ä–∞—Ü—ñ—ó
- **Redis** ‚Äî –∫–µ—à —ñ —á–µ—Ä–≥–∏
- **BullMQ** ‚Äî –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏
- **@nestjs-modules/mailer** + **nodemailer** ‚Äî –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ email
- **Swagger** ‚Äî OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

---

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

## üîê –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ .env –∑–º—ñ–Ω–Ω—ñ (dev)

```env
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=climatic

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

WEATHER_API_KEY=your_weatherapi_key
WEATHER_API_URL=https://api.weatherapi.com

MAIL_HOST=your_mail_host
MAIL_PORT=587
MAIL_PASSWORD=your_mail_password
MAIL_FROM=Climatic <your@mail.com>

JWT_SECRET=supersecretstring

BASE_URL=http://localhost:3000

```

### üîß –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
git clone https://github.com/v-olishynskyi/climatic-api
cd climatic-api

make dev-up     # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º—ñ dev
docker ps       # –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
```

### üìÇ –î–æ—Å—Ç—É–ø–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Swagger: [http://localhost:3000/docs](http://localhost:3000/docs)
- Redis: localhost:6379
- PostgreSQL: localhost:5432

---

## üìß API –ï–Ω–¥–ø–æ—ó–Ω—Ç–∏

| Method | Endpoint              | Description                |
| ------ | --------------------- | -------------------------- |
| POST   | `/weather`            | –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø–æ–≥–æ–¥—É |
| POST   | `/subscribe`          | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏         |
| GET    | `/confirm/:token`     | –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è email        |
| GET    | `/unsubscribe/:token` | –í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –æ–Ω–æ–≤–ª–µ–Ω—å       |
| GET    | `/docs`               | Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è       |

---

---

## üìÜ Makefile –∫–æ–º–∞–Ω–¥–∏

```makefile
make dev-up          # –ó–∞–ø—É—Å–∫ docker-compose.dev.yml
make dev-down        # –°—Ç–æ–ø docker
make prod-up         # –ó–∞–ø—É—Å–∫ docker-compose.prod.yml
make dev-down        # –°—Ç–æ–ø docker
make logs            # –ü–æ—Ç–æ—á–Ω—ñ –ª–æ–≥–∏ API
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–ü—Ä–æ—î–∫—Ç –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ **SOLID**, **Clean Architecture**, —Ç–∞ **Modular Architecture** NestJS.

```
src/
‚îÇ
‚îú‚îÄ‚îÄ config/ # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤
‚îÇ ‚îú‚îÄ‚îÄ config.module.ts # –ì–ª–æ–±–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ñ—ñ–≥ –º–æ–¥—É–ª—å
‚îÇ ‚îú‚îÄ‚îÄ shared-config.service.ts# –û–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–º—ñ–Ω–Ω–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
‚îÇ ‚îú‚îÄ‚îÄ *.config.ts # –¢–µ–º–∞—Ç–∏—á–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥–∏: redis, jwt, mail, db
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/ # –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ (–ø–æ—à—Ç–∞, –±–∞–∑–∞, —à–µ–¥—É–ª–µ—Ä–∏)
‚îÇ ‚îú‚îÄ‚îÄ database/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ migrations/ # –§–∞–π–ª–∏ –º—ñ–≥—Ä–∞—Ü—ñ–π
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ database.module.ts # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ —á–µ—Ä–µ–∑ TypeORM
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ typeorm.config.ts # –ö–æ–Ω—Ñ—ñ–≥ –¥–ª—è cli-–º—ñ–≥—Ä–∞—Ü—ñ–π
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ mail/ # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ—à—Ç–∏
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ dto/ # DTO –¥–ª—è –º–µ–π–ª—ñ–Ω–≥—É
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ factory/ # –®–∞–±–ª–æ–Ω–∏ –ª–∏—Å—Ç—ñ–≤ —á–µ—Ä–µ–∑ MailFactory
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ services/ # mail.service.ts
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ templates/ # Handlebars —à–∞–±–ª–æ–Ω–∏ –ª–∏—Å—Ç—ñ–≤
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ mail.module.ts
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ schedulers/ # –ö—Ä–æ–Ω-–¥–∂–æ–±–∏
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ services/ # –ö—Ä–æ–Ω —Å–µ—Ä–≤—ñ—Å–∏
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ scheduler.module.ts
‚îÇ
‚îú‚îÄ‚îÄ weather/ # –ú–æ–¥—É–ª—å —Ä–æ–±–æ—Ç–∏ –∑ weather API
‚îÇ ‚îú‚îÄ‚îÄ controllers/
‚îÇ ‚îú‚îÄ‚îÄ dto/
‚îÇ ‚îú‚îÄ‚îÄ services/ # WeatherService + WeatherCacheService
‚îÇ ‚îî‚îÄ‚îÄ weather.module.ts
‚îÇ
‚îú‚îÄ‚îÄ modules/subscription/ # –ú–æ–¥—É–ª—å –ø—ñ–¥–ø–∏—Å–æ–∫
‚îÇ ‚îú‚îÄ‚îÄ controllers/
‚îÇ ‚îú‚îÄ‚îÄ dto/
‚îÇ ‚îú‚îÄ‚îÄ entities/ # subscription.entity.ts
‚îÇ ‚îú‚îÄ‚îÄ enum/
‚îÇ ‚îú‚îÄ‚îÄ factory/
‚îÇ ‚îú‚îÄ‚îÄ services/
‚îÇ ‚îî‚îÄ‚îÄ subscription.module.ts
‚îÇ
‚îú‚îÄ‚îÄ queues/ # –†–æ–±–æ—Ç–∞ –∑ BullMQ —á–µ—Ä–≥–∞–º–∏
‚îÇ ‚îú‚îÄ‚îÄ mail-confirmation/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ *.queue.module.ts # –ß–µ—Ä–≥–∞ –¥–ª—è –ª–∏—Å—Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ .queue.processor.ts
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ .queue.service.ts
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ mail-weather/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ weather-daily.queue.
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ weather-hourly.queue.
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ weather-queue-dispatcher.service.ts # –î–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è –∑–∞–¥–∞—á –ø–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è—Ö
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ weather-queue.types.ts
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ constants.ts
‚îÇ ‚îî‚îÄ‚îÄ queues.module.ts
‚îÇ
‚îú‚îÄ‚îÄ redis/ # IORedis –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
‚îÇ ‚îú‚îÄ‚îÄ constants.ts
‚îÇ ‚îî‚îÄ‚îÄ redis.module.ts
‚îÇ
‚îú‚îÄ‚îÄ shared/ # –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ —Ç–∞ —É—Ç–∏–ª—ñ—Ç–∏
‚îÇ ‚îú‚îÄ‚îÄ helpers/ # –ù–∞–ø—Ä–∏–∫–ª–∞–¥ url.helper.ts
‚îÇ ‚îî‚îÄ‚îÄ jwt/ # JWT-—Å–µ—Ä–≤—ñ—Å –¥–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏/–≤—ñ–¥–ø–∏—Å–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ main.ts # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
‚îú‚îÄ‚îÄ app.module.ts # –ö–æ—Ä–µ–Ω–µ–≤–∏–π –º–æ–¥—É–ª—å
‚îî‚îÄ‚îÄ swagger.ts # Swagger –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
```

### –Ü–Ω—à—ñ —Ñ–∞–π–ª–∏:

- `.env`, `.env.prod` ‚Äî –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è –¥–µ–≤/–ø—Ä–æ–¥
- `Makefile` ‚Äî –∫–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `make dev-up`, `make prod-up`, `make migrate`)
- `docker-compose.yml`, `docker-compose.prod.yml` ‚Äî Docker –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è dev —ñ prod
- `Dockerfile`, `Dockerfile_prod` ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–µ–≤–µ–ª–æ–ø–µ—Ä—Å—å–∫–∏–π —Ç–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –±—ñ–ª–¥

---

## üë®‚Äçüíº –ê–≤—Ç–æ—Ä

**–í–ª–∞–¥–∏—Å–ª–∞–≤ –û–ª—ñ—à–∏–Ω—Å—å–∫–∏–π**
[GitHub: @v-olishynskyi](https://github.com/v-olishynskyi)

---
